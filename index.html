<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>MCV-Task</title>

	<!-- Global stylesheets -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
	<link href="assets/css/icons/icomoon/styles.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/bootstrap_custom.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/layout.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/components.min.css" rel="stylesheet" type="text/css">
	<link href="assets/css/colors.min.css" rel="stylesheet" type="text/css">
	<!-- /global stylesheets -->

	<!-- Core JS files -->
	<script src="assets/js/main/jquery.min.js"></script>
	<script src="assets/js/main/bootstrap.bundle.min.js"></script>
	<script src="assets/js/plugins/loaders/blockui.min.js"></script>
	<!-- /core JS files -->

	<!-- Theme JS files -->
	<script src="assets/js/plugins/forms/styling/uniform.min.js"></script>
	<script src="assets/js/main/app.js"></script>
	<script src="assets/js/main/custom_page.js"></script>
	<!-- /theme JS files -->

</head>

<body class="navbar-top">

	<!-- Main navbar -->
	<div class="navbar navbar-expand-md navbar-dark fixed-top">
		<div class="navbar-brand">
			<a href="index.html" class="d-inline-block">
				<img src="assets/images/logo.png" alt="">
			</a>
		</div>

		<div class="d-md-none">
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-mobile">
				<i class="icon-tree5"></i>
			</button>
			<button class="navbar-toggler sidebar-mobile-main-toggle" type="button">
				<i class="icon-paragraph-justify3"></i>
			</button>
		</div>

		<div class="collapse navbar-collapse" id="navbar-mobile">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a href="#" class="navbar-nav-link sidebar-control sidebar-main-toggle d-none d-md-block">
						<i class="icon-paragraph-justify3"></i>
					</a>
				</li>
			</ul>

			<ul class="navbar-nav ml-auto">

				<li class="nav-item dropdown dropdown-user">
					<a href="#" class="navbar-nav-link d-flex align-items-center dropdown-toggle" data-toggle="dropdown">
						<img src="assets/images/image.png" class="rounded-circle mr-2" height="34" alt="">
						<span>MCV</span>
					</a>

					<div class="dropdown-menu dropdown-menu-right">
						<a href="#" class="dropdown-item"><i class="icon-user-plus"></i> My profile</a>
						<a href="#" class="dropdown-item"><i class="icon-coins"></i> My balance</a>
						<a href="#" class="dropdown-item"><i class="icon-comment-discussion"></i> Messages <span
								class="badge badge-pill bg-blue ml-auto">58</span></a>
						<div class="dropdown-divider"></div>
						<a href="#" class="dropdown-item"><i class="icon-cog5"></i> Account settings</a>
						<a href="#" class="dropdown-item"><i class="icon-switch2"></i> Logout</a>
					</div>
				</li>
			</ul>
		</div>
	</div>
	<!-- /main navbar -->


	<!-- Page content -->
	<div class="page-content">

		<!-- Main sidebar -->
		<div class="sidebar sidebar-dark sidebar-main sidebar-fixed sidebar-expand-md">

			<!-- Sidebar mobile toggler -->
			<div class="sidebar-mobile-toggler text-center">
				<a href="#" class="sidebar-mobile-main-toggle">
					<i class="icon-arrow-left8"></i>
				</a>
				Navigation
				<a href="#" class="sidebar-mobile-expand">
					<i class="icon-screen-full"></i>
					<i class="icon-screen-normal"></i>
				</a>
			</div>
			<!-- /sidebar mobile toggler -->


			<!-- Sidebar content -->
			<div class="sidebar-content">

				<!-- User menu -->
				<div class="sidebar-user">
					<div class="card-body">
						<div class="media">
							<div class="mr-3">
								<a href="#"><img src="assets/images/image.png" width="38" height="38" class="rounded-circle" alt=""></a>
							</div>

							<div class="media-body">
								<div class="media-title font-weight-semibold">MCV</div>
								<div class="font-size-xs opacity-50">
									<i class="icon-pin font-size-sm"></i> &nbsp;Cairo, Egypt
								</div>
							</div>

							<div class="ml-3 align-self-center">
								<a href="#" class="text-white"><i class="icon-cog3"></i></a>
							</div>
						</div>
					</div>
				</div>
				<!-- /user menu -->


				<!-- Main navigation -->
				<div class="card card-sidebar-mobile">
					<ul class="nav nav-sidebar" data-nav-type="accordion">

						<!-- Main -->
						<li class="nav-item-header">
							<div class="text-uppercase font-size-xs line-height-xs">Main</div> <i class="icon-menu" title="Main"></i>
						</li>
						<li class="nav-item">
							<a href="index.html" class="nav-link active">
								<i class="icon-home4"></i>
								<span>Dashboard 1</span>
							</a>
						</li>
						<li class="nav-item">
							<a href="index2.html" class="nav-link">
								<i class="icon-home4"></i>
								<span>Dashboard 2</span>
							</a>
						</li>
						<li class="nav-item nav-item-submenu">
							<a href="#" class="nav-link"><i class="icon-stack"></i> <span>Employees</span></a>

							<ul class="nav nav-group-sub" data-submenu-title="Starter kit">
								<li class="nav-item"><a href="Myprofile.html" class="nav-link">My Profile</a></li>
								<li class="nav-item"><a href="vacations.html" class="nav-link">Vacations</a></li>
							</ul>
						</li>
						<!-- /main -->

					</ul>
				</div>
				<!-- /main navigation -->

			</div>
			<!-- /sidebar content -->

		</div>
		<!-- /main sidebar -->


		<!-- Main content -->
		<div class="content-wrapper">

			<!-- Page header -->
			<div class="page-header page-header-light">
				<div class="page-header-content header-elements-md-inline">
					<div class="page-title d-flex">
						<h4><i class="icon-arrow-left52 mr-2"></i> <span class="font-weight-semibold">Home</span> - Dashboard 1</h4>
						<a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
					</div>

				</div>

				<div class="breadcrumb-line breadcrumb-line-light header-elements-md-inline">
					<div class="d-flex">
						<div class="breadcrumb">
							<a href="index.html" class="breadcrumb-item active"><i class="icon-home2 mr-2"></i> Home</a>
						</div>

						<a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
					</div>

				</div>
			</div>
			<!-- /page header -->


			<!-- Content area -->
			<div class="content">
				<div class="row">
					<div id="line_1"></div>
					<div id="line_2"></div>
					<div id="line_3"></div>
				</div>

			</div>
			<!-- /content area -->


			<!-- Footer -->
			<div class="navbar navbar-expand-lg navbar-light">
				<div class="text-center d-lg-none w-100">
					<button type="button" class="navbar-toggler dropdown-toggle" data-toggle="collapse"
						data-target="#navbar-footer">
						<i class="icon-unfold mr-2"></i>
						Footer
					</button>
				</div>

				<div class="navbar-collapse collapse" id="navbar-footer">
					<span class="navbar-text">
						&copy; 2021 - 2022. <a href="#">MCV-Task</a> by <a href="https://www.linkedin.com/in/minakamil"
							target="_blank">Mina
							Kamil</a>
					</span>
				</div>
			</div>
			<!-- /footer -->

		</div>
		<!-- /main content -->


	</div>
	<!-- /page content -->
	<script>
		$(function () {
			$.ajax({
				url: 'assets/js/json/dashboard/data.json',
				dataType: 'json',
				cache: false,
				success: function (data, status) {
					// check BusID if empty
					//data = data.filter(d => d.BusID !== "");
					let linesData = [...new Map(data.map(item => [item['LineID'], {
						"LineID": item.LineID,
						"LineName": item.LineName
					}])).values()];

					linesData = linesData.sort((d1, d2) => (d1.LineID > d2.LineID) ? 1 : -1);

					$.each(linesData, function (index, line) {
						let stationsData = [...new Map(data.filter(d => d.LineID === line.LineID).map(
							item => [item[
								'StationID'], {
								"StationID": item.StationID,
								"StationName": item.StationName
							}])).values()];
						$.each(stationsData, function (index, station) {
							let busesData = [...new Map(data.filter(d => d.LineID === line.LineID && d
								.StationID === station.StationID).map(item => [item[
								'BusID'], {
								"BusID": item.BusID,
								"BusModel": item.BusModel
							}])).values()];
							station.Buses = busesData.sort((d1, d2) => (d1.BusID > d2.BusID) ? 1 : -1);
						});
						line.Stations = stationsData.sort((d1, d2) => (d1.StationID > d2.StationID) ? 1 : -1);
					});

					console.log(linesData);
					// total buses for all lines
					busCount = data.filter(d => d.BusID !== "").length;
					$('#BusModalTotal').text(busCount);
					// total lines
					linesCount = linesData.length;
					$('#totalLines').text(linesCount);

					$.each(linesData, function (index, line) {
						// total buses for per line
						let busesCountPerLine = data.filter(d => d.BusID !== "" && d.LineID === line.LineID).length;
						//Line Color
						let lineColor;
						if (line.LineID == 1) {
							lineColor = "info";
						} else if (line.LineID == 2) {
							lineColor = "teal";
						} else if (line.LineID == 3) {
							lineColor = "blue";
						} else {
							lineColor = "success";
						}
						divContent = `
						<div class="card border-${lineColor}">
							<div class="card-header bg-${lineColor} text-white header-elements-inline">
								<h6 class="card-title">${line.LineName}</h6>
								<div class="header-elements">
									<div class="list-icons">
										<a class="list-icons-item" data-action="collapse"></a>
									</div>
								</div>
							</div>
							<div class="card-body">
						<div class="table-responsive mb-3">
							<table class="table table-bordered table-stripe">
								<thead>
									<tr>
										<!-- total stations -->
										<th class="col-lg-3 col-sm-6">${line.Stations.length} Station(s)</th>
										<!-- total buses per line -->
										<th class="col-lg-9 col-sm-6">${busesCountPerLine} Bus(es)
											<!-- 
												<div class="float-right text-${lineColor}">${line.LineName}</div>-->
											</th>
									</tr>
								</thead>
								<tbody class="table-hover">`;

						$.each(line.Stations, function (index, station) {
							divContent += `
							<tr class="border-top-${lineColor}">
								<td class="text-center">
									<h6 class="mb-0"># ${station.StationID}</h6>
									<div class="font-size-sm text-muted line-height-1">${station.StationName}</div>
								</td>
								<td>
								<ul class="list list-unstyled mb-0 list-inline">`;
							$.each(station.Buses.filter(d => d.BusID !== ""), function (index, bus) {
								divContent += `
								<li class="list-inline-item">
								<div class="d-flex align-items-center">
									<div class="mr-2 mb-1 ml-3">
										<a href="#" class="btn bg-${lineColor} rounded-round btn-icon">
											<i class="icon-bus"></i>
										</a>
									</div>
									<div>
										<a href="#" class="text-default font-weight-semibold letter-icon-title">${bus.BusModel}</a>
										<div class="text-muted font-size-sm"><span class="badge badge-mark border-${lineColor} mr-1"></span>
											# ${bus.BusID}
										</div>
									</div>
									</div>
									</li>
							`;
							});
							divContent += `
								</div>
								</td>
							</tr>
						`;
						})
						divContent += `
								</tbody>
							</table>
							</div>
							</div>
						</div>`;
						$('#line_' + line.LineID).addClass('col-lg-' + 12 / linesCount).append(divContent)
					});
				}
			});
		});
	</script>
</body>

</html>